{"data":{"site":{"siteMetadata":{"url":"https://developer-diary.netlify.com","title":"Developer Diary","labels":[{"tag":"react","tech":"React","name":"DiReact","size":20,"color":"deepskyblue"},{"tag":"nodejs","tech":"Node.js","name":"DiNodejsSmall","size":20,"color":"lightgreen"},{"tag":"git","tech":"Git","name":"DiGitMerge","size":20,"color":"white"},{"tag":"javascript","tech":"JavaScript","name":"DiJsBadge","size":20,"color":"yellow"},{"tag":"css","tech":"CSS","name":"DiCss3Full","size":20,"color":"teal"},{"tag":"python","tech":"Python","name":"DiPython","size":20,"color":"deepskyblue"},{"tag":"ruby","tech":"Ruby","name":"DiRuby","size":20,"color":"crimson"},{"tag":"java","tech":"Java","name":"FaJava","size":20,"color":"wheat"},{"tag":"angular","tech":"Angular","name":"DiAngularSimple","size":20,"color":"red"},{"tag":"html","tech":"HTML","name":"FaHtml5","size":20,"color":"darkorange"},{"tag":"php","tech":"php","name":"DiPhp","size":20,"color":"violet"},{"tag":"mongodb","tech":"MongoDB","name":"DiMongodb","size":20,"color":"green"},{"tag":"vscode","tech":"VS Code","name":"DiVisualstudio","size":20,"color":"deepskyblue"}]}},"markdownRemark":{"html":"<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris sapien nisi, consequat nec dolor ut, lobortis vestibulum nunc. Nulla facilisi. Suspendisse leo urna, pulvinar ut pretium sit amet, consequat eget sapien. Nam ultricies in nulla finibus feugiat. Maecenas lacinia, lorem quis egestas convallis, tortor nunc consectetur est, vel finibus odio dui et nunc. Proin quis ante ut felis lacinia dignissim quis ac risus. Vestibulum a maximus est. Pellentesque malesuada eros ac diam aliquam, non pulvinar magna sodales. Fusce hendrerit malesuada quam, ut accumsan massa efficitur et. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Nullam vitae ornare sem, eget volutpat mauris. Praesent aliquet condimentum dui non bibendum. Nam dapibus rutrum mi sit amet luctus. Proin id vehicula risus. Nullam dictum, elit sit amet molestie eleifend, felis dolor scelerisque risus, sed dictum odio dolor id justo. Integer consectetur dui non tortor scelerisque, non vulputate sem laoreet:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">const express = require(&#39;express&#39;)\nconst app = express()\nconst bodyParser = require(&#39;body-parser&#39;)\n\nconst cors = require(&#39;cors&#39;)\n\nconst mongoose = require(&#39;mongoose&#39;)\nmongoose.connect(process.env.DB_URI || &#39;mongodb://localhost/dbname&#39; )\n\napp.use(cors())\n\napp.use(bodyParser.urlencoded({extended: false}))\napp.use(bodyParser.json())\n\n\napp.use(express.static(&#39;public&#39;))\napp.get(&#39;/&#39;, (req, res) =&gt; {\n  res.sendFile(__dirname + &#39;/views/index.html&#39;)\n});\n\n\n// Not found middleware\napp.use((req, res, next) =&gt; {\n  return next({status: 404, message: &#39;not found&#39;})\n})\n\n\nconst listener = app.listen(process.env.PORT || 3000, () =&gt; {\n  console.log(&#39;Your app is listening on port &#39; + listener.address().port)\n})</code></pre></div>\n<br>\n<p>Nunc blandit purus sit amet justo vehicula, at venenatis ante tempus. Integer sagittis ultrices lorem, ut faucibus erat molestie quis. Phasellus semper orci nisl, egestas maximus risus porta sit amet. Fusce vitae egestas sem. Nunc sagittis, erat sodales maximus tempus, magna diam iaculis ex, ut feugiat odio libero sit amet lectus. Suspendisse elit turpis, volutpat laoreet consequat ac, ultricies eu sem. Donec non orci in justo porta iaculis. Donec pulvinar nunc quis viverra volutpat. Quisque et orci non enim sodales eleifend. Etiam in enim id nulla posuere lacinia. Ut rutrum pharetra nisi quis feugiat. Cras arcu lectus, euismod a lacinia a, cursus vitae magna. Aenean ultricies, enim id pharetra ultricies, ligula lectus congue tellus, ac lobortis ex elit at nulla. Sed lobortis vitae tortor sed laoreet. Praesent porta bibendum ullamcorper:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// Not found middleware\napp.use((req, res, next) =&gt; {\n  return next({status: 404, message: &#39;not found&#39;})\n})\n\napp.post(&#39;/api/users/new-user&#39;, (req, res) =&gt;{\n const firstName = req.body.first_name;\n const lastName  = req.body.last_name;\n res.json({first_name: firstName, last_name: lastName, &quot;status&quot;: &quot;registered&quot;});\n})</code></pre></div>\n<br>\n<p>Integer fermentum euismod risus, vitae fringilla erat condimentum at. Suspendisse luctus egestas dui, eu dictum sem tincidunt sed. Sed efficitur eget orci eu dictum. Etiam faucibus, enim nec tincidunt sollicitudin, diam neque ultricies magna, eget ultrices sem tortor non justo. Vestibulum viverra tincidunt elit sit amet gravida. Morbi sed tempus odio. Nunc efficitur ultricies elit et porta. Praesent finibus placerat felis, vitae efficitur ligula sagittis non. Nam fringilla malesuada ligula ullamcorper dignissim.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">app.use((req, res, next) =&gt; {\n  console.log(&#39;fire 1&#39;)\n  return next({status: 404, message: &#39;not found&#39;})\n});\n\napp.post(&#39;/api/users/new-user&#39;, (req, res) =&gt;{\n  console.log(&#39;fire 2&#39;)\n  const firstName = req.body.first_name;\n  const lastName  = req.body.last_name;\n  res.json({first_name: firstName, last_name: lastName, &quot;status&quot;: &quot;registered&quot;});\n});</code></pre></div>\n<br>\n<p>Morbi mauris lacus, vehicula eget ullamcorper et, fringilla at ipsum. Nam tempus felis ex, congue varius urna consectetur eget. Cras tempor condimentum accumsan. In hac habitasse platea dictumst. Nulla pharetra mauris enim, quis dictum ipsum dictum sed. Sed luctus eros volutpat, luctus augue et, tempus ante:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Your app is listening on port 3000\nfire 1\n[object Object]</code></pre></div>\n<br>\n<p>Sed imperdiet diam id luctus faucibus. Sed ullamcorper suscipit arcu, in dictum lectus ultricies et. Donec accumsan a ipsum sed aliquet. Nulla auctor justo eget tincidunt egestas. Cras blandit, ante vitae facilisis hendrerit, justo mauris fermentum diam, id congue diam velit eu ipsum. Nullam pulvinar auctor tincidunt. Maecenas felis velit, bibendum ac purus nec, cursus lacinia nulla. Sed posuere orci sapien, id accumsan eros feugiat vel. Aenean convallis lacinia orci. In metus elit, iaculis vitae nisi vel, iaculis vehicula mi.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// not-found middleware\napp.use((req, res, next) =&gt; {\n  console.log(&#39;fire 1&#39;)\n  return next({status: 404, message: &#39;not found&#39;})\n});\n\n// error-handler middleware\napp.use((err, req, res, next) =&gt; {\n  console.log(&#39;fire 2&#39;)\n  console.log(err);\n  let errCode, errMessage\n\n  if (err.errors) {\n    // mongoose validation error\n    errCode = 400 // bad request\n    const keys = Object.keys(err.errors)\n    // report the first validation error\n    errMessage = err.errors[keys[0]].message\n  } else {\n    // generic or custom error\n    errCode = err.status || 500\n    errMessage = err.message || &#39;Internal Server Error&#39;\n  }\n  res.status(errCode).type(&#39;txt&#39;)\n    .send(errMessage)\n});\n\napp.post(&#39;/api/users/new-user&#39;, (req, res) =&gt;{\n  console.log(&#39;fire 3&#39;)\n  const firstName = req.body.first_name;\n  const lastName  = req.body.last_name;\n  res.json({first_name: firstName, last_name: lastName, &quot;status&quot;: &quot;registered&quot;});\n});</code></pre></div>\n<br>\n<p>Nam elementum augue vel nulla consectetur elementum. Curabitur tincidunt hendrerit justo. Praesent nisl dui, mollis vitae quam eu, dignissim faucibus lorem:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Your app is listening on port 3000\nfire 1\nfire 2\n{ status: 404, message: &#39;not found&#39; }</code></pre></div>\n<br>\n<p>Sed vitae erat at sem suscipit laoreet nec vel diam. Donec at quam sapien. Nulla quis egestas metus, ut tempus elit. Vivamus placerat diam ac ultrices finibus. Aenean vitae molestie eros. Curabitur pulvinar ornare est volutpat consequat. Vivamus ullamcorper pharetra leo ac volutpat. Curabitur efficitur egestas posuere. Duis ut sagittis diam, sed sollicitudin lectus. Phasellus in lorem maximus, volutpat felis non, fringilla mi. Curabitur in fringilla sem, nec rhoncus elit. Aenean non ante dignissim elit suscipit hendrerit sit amet nec eros. Curabitur feugiat, metus non convallis scelerisque, nisl urna imperdiet velit, eget semper enim ante eget lorem.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">app.post(&#39;/api/users/new-user&#39;, (req, res) =&gt;{\n  console.log(&#39;fire 1&#39;)\n  const firstName = req.body.first_name;\n  const lastName  = req.body.last_name;\n  res.json({first_name: firstName, last_name: lastName, &quot;status&quot;: &quot;registered&quot;});\n});\n\n\n// Not found middleware\napp.use((req, res, next) =&gt; {\n  console.log(&#39;fire 2&#39;)\n  return next({status: 404, message: &#39;not found&#39;})\n});\n\n// Error Handling middleware\napp.use((err, req, res, next) =&gt; {\n  console.log(&#39;fire 3&#39;)\n  console.log(err);\n  let errCode, errMessage\n\n  if (err.errors) {\n    // mongoose validation error\n    errCode = 400 // bad request\n    const keys = Object.keys(err.errors)\n    // report the first validation error\n    errMessage = err.errors[keys[0]].message\n  } else {\n    // generic or custom error\n    errCode = err.status || 500\n    errMessage = err.message || &#39;Internal Server Error&#39;\n  }\n  res.status(errCode).type(&#39;txt&#39;)\n    .send(errMessage)\n})</code></pre></div>\n<br>\n<p>Nulla pharetra mauris enim, quis dictum ipsum dictum sed. Sed luctus eros volutpat, luctus augue et, tempus ante. Sed imperdiet diam id luctus faucibus. Sed ullamcorper suscipit arcu, in dictum lectus ultricies et. Donec accumsan a ipsum sed aliquet. Nulla auctor justo eget tincidunt egestas:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Your app is listening on port 3000\nfire 1</code></pre></div>\n<br>\n<p> Donec at quam sapien. Nulla quis egestas metus, ut tempus elit. Vivamus placerat diam ac ultrices finibus. Aenean vitae molestie eros. Curabitur pulvinar ornare est volutpat consequat. Vivamus ullamcorper pharetra leo ac volutpat. Curabitur efficitur egestas posuere.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{&quot;first_name&quot;:&quot;Walter&quot;,&quot;last_name&quot;:&quot;White&quot;,&quot;status&quot;:&quot;registered&quot;}</code></pre></div>\n<br>\n<p>consectetur elementum.</p>","frontmatter":{"title":"Misplaced Middleware in Express","featuredImage":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAD2klEQVQ4y3WUW2xUVRSGDyY+8MCLTxofvNNWqPY61Wgk4IvxEmI1ktpxOm2n01IKCg8gCYpGgxgkpTB3LjOlnaYNDQGaaC0kpbaVS0molWYql9SMGDWxRBrajt3nrOX6d+cMo5aTrOx99uXba61/7W14i0MGvrqikOEtDt+HvqcgeH+DI/LO+rKDnQ2lkUmZU2JmfWkkKWPdMlcp/0uxFnvqisJGum/YnSVNLxy2+2tlQ6KhKMrVuRF2LfezpyDEnsIQu3L87M6JcENhlGXNDVlbYRh3GRlqFmzXBkeM3Xkh3vTSEdWxe1D9OJy0bl6bopvXp2j83C/Utfd7tXl1TLlzg9zkOMreknBLFtTIhAnYprI4V+X5zOjOfnM+pYiZCbCRvut0sfcaJX/6U49ZpsXxLwbNqqd9qqm0netLwr502jJeroVngPVELlmyiS/3T9KONztJNrFz+X5trjwfb3+jg85/fRVg7u+6QrJXpT11GlkCJBAmPMPCk8ERqnxqP7tX+HE6ixgLJv3qlX6ueHwfH2s+R5ZF/PFbXWZtfhhzSYEvM6AmBGh68bD6e07R6MDP5BSYNw2SRf8yjEloIlSQt73aTmjh5YbSVrQeA6UBNeVEhfxsfz1O8EwO0huzYfa/9lqs5pkAWrKBMt9joM6qcgMc+/Qsckd9bT/oXGlIyV1Idlv7bFAbvJOWxKz1JUcwPw5lFMJY92gzdXw5pJN9Oj7GrtwDi0LhmZRUxj5YHaP3V0WpvlhHNGNIwZqNzx/i0NY+qnyyhdp3fceLQQFyiyAflXfy9NQsp2bneWY6xTO3UzQx8ivVFeq0zBm4TrgBKNqhkxNU/uAeju8e/B8UUSDMzWti3N1ynk/4LyLvfOevOZq88odVu1JXQQKidEMUgWhRvm0dpbcf3rs4VLxE3t6T/4rH9rHkn01lUU/4kgmGCPkNysaJu7nl5VY1fWuWbWHuBYX6jc8dZEkPD3SP65x/+Fpc1Rfo+90IUZbiouNuiii6sO8JFfVr8gO6sGOf9GvYcd8F05UTgLe/CesB++pV4PpI0tWZjjGyob2to1z+0FdsC4VDRFE+e2zBs+FTE1SdH5jf6GiDcF4btvA4yKux0dGuoZ17hs07t1MaOnQiQe8+0ULiqX4Y0sbHD1wwF2Bx5DaaecIyj6J8eDXgaZWEv/WVNoXbc2Psd+voZwO07pFmavt8wOqNXTYxhzDhmQ3775u4JGvQKTlNQigoh3JoLDukFa1ZEdZjWgDJmaz1LgILZR5He7CuMLRMoB4pqR7xYFz+Z1C0UosJlAbUtAXAHnsfGP8An71yIvslifEAAAAASUVORK5CYII=","aspectRatio":1,"src":"/static/4a9773549091c227cd2eb82ccd9c5e3a/647de/gatsby-icon.png","srcSet":"/static/4a9773549091c227cd2eb82ccd9c5e3a/bf65b/gatsby-icon.png 100w,\n/static/4a9773549091c227cd2eb82ccd9c5e3a/7c0ed/gatsby-icon.png 200w,\n/static/4a9773549091c227cd2eb82ccd9c5e3a/647de/gatsby-icon.png 400w,\n/static/4a9773549091c227cd2eb82ccd9c5e3a/774d6/gatsby-icon.png 512w","sizes":"(max-width: 400px) 100vw, 400px"}}},"date":"December 29, 2018","tags":["nodejs","express"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/misplaced-middleware-in-express/"}}